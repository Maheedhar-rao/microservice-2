<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lender Portal</title>
  <style>
    body {
      font-family: 'Montserrat', sans-serif;
      margin: 0;
      padding: 0;
      background: linear-gradient(to right, #ad2656, #4579b6);
      text-align: center;
      color: white;
    }
    .container {
      max-width: 800px;
      margin: 40px auto;
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0px 4px 20px rgba(0, 0, 0, 0.4);
      color: black;
    }
    h1 {
      color: #3271af;
      font-size: 26px;
      margin-bottom: 20px;
    }
    .lender-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 12px;
      margin: 20px 0;
    }
    .lender {
      padding: 14px;
      background: linear-gradient(to right, #56ab2f, #a8e063);
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      text-align: center;
      transition: all 0.3s ease-in-out;
      word-break: break-word;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .lender:hover {
      background: #45a049;
      transform: scale(1.08);
    }
    .selected {
      background: #ff4757;
      color: white;
      border: 2px solid #e84118;
    }
    .summary {
      margin-top: 20px;
      color: #c0392b;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Submission Dashboard</h1>
    <h3>Select Lenders</h3>
    <div class="lender-grid" id="lender-grid"></div>
    <div class="summary">
      <h3>You're about to submit to the following lenders:</h3>
      <p id="selected-lenders" style="white-space: pre-line; text-align: center; font-weight: bold;"></p>
    </div>
  </div>

  <script>
    const lenders = [
  "Test",
  "Alternative",
  "American Choice",
  "Arena",
  "Aspire Funding",
  "Amsterdam Capital",
  "Barclays",
  "BCA Business Cash Adv",
  "BC Providers",
  "Biz2Credit",
  "Broadway Advance",
  "Capital Assist",
  "Capital Domain",
  "Capybara",
  "Capytal/Newco",
  "Cashable",
  "Cashfloit",
  "Cobalt",
  "Clear Fund/Litefund",
  "Stone Street",
  "Cromwell Capital",
  "E Advance",
  "Eminent",
  "Equita",
  "Everest/Vader/Granite",
  "Family business fund",
  "Fenix",
  "Finpoint",
  "Fintap",
  "Fundnow",
  "Fundfi",
  "Fundpro",
  "Fundkite",
  "Fundr",
  "Fundworks",
  "Fundomate",
  "G&G",
  "GFE",
  "Green Note",
  "Highland Hill",
  "Highpower",
  "Honest",
  "IOU",
  "Insta funders",
  "Jaffe",
  "JRG Funding",
  "Kapitus",
  "Kalamata Capital",
  "Legend",
  "Legendary",
  "Last Chance",
  "LendBug",
  "Libertas",
  "Lifetime",
  "Lily Advance",
  "md Capital",
  "Meged",
  "Merchant marketplace",
  "Mint",
  "Merit",
  "MNY",
  "MNR Capital",
  "Moneywell",
  "Mr.Advance",
  "Nitro Advance",
  "Ocean",
  "Overton",
  "QFS",
  "Quikstone",
  "Radiance",
  "Rapid",
  "RBLX",
  "Right Away Capital",
  "Rocket Cap",
  "Rowan",
  "SFS",
  "Smart Step",
  "Smarter Merchant",
  "Spartan",
  "Superfast Cap",
  "Torro",
  "TVT",
  "Velocity",
  "Vivian",
  "Vox",
  "Wall",
  "Wellen",
  "Zinch Fin",
  "501 Advance",
  "Wynwood",
  "WG Financing",
  "PORTALS",
  "ARF Funding (LoC)",
  "Torro SLOC",
  "Harvest SBF (Asset)",
  "Loanbud (Asset)",
  "Maxim (Asset)",
  "WBL (Asset)",
  "Athas (Asset)",
  "Velocity Mortgage (Asset)",
  "Commercial Loan Center (Asset)",
  "AFG (Equip)",
  "Lendspark (Equip)",
  "Amerifactors (AR)",
  "Bankers Factoring (AR)",
  "Bayview (AR)",
  "Riviera (AR)",
  "Seacoast (AR)",
  "OGF (Term)",
  "Shield Advisory (Term)",
  "Ultum (Term)",
  "Value Capital (Term)",
  "Wing lake (Term)",
  "WG Finanacing",
  "ART Funding",
  "Bluebridge",
  "Bow Apple",
  "FND",
  "Fratello",
  "Instafunders",
  "Nexi",
  "Ora Capital",
  "RBR",
  "Silverline"
];


    const lenderGrid = document.getElementById('lender-grid');
    lenders.forEach(lender => {
      const div = document.createElement('div');
      div.classList.add('lender');
      div.textContent = lender;
      div.onclick = function() {
        div.classList.toggle('selected');
        updateSelectedLenders();
      };
      lenderGrid.appendChild(div);
    });

    function updateSelectedLenders() {
      const selected = [...document.querySelectorAll('.lender.selected')].map(el => el.textContent);
      document.getElementById('selected-lenders').innerHTML = selected.length ? selected.join('\n') : 'None selected';
    }

    fetch('test.json')
      .then(res => res.json())
      .then(funderRules => {
        const borrower = JSON.parse(localStorage.getItem('borrowerData')) || {};
        const fico = parseInt(borrower.fico || 0);
        const rev = parseInt((borrower.revenue || borrower.amount || '0').replace(/[^0-9]/g, ''));
        const tib = parseInt(borrower.tib || 0);
        const industry = (borrower.industry || '').toLowerCase();
        const state = (borrower.state || '').toUpperCase();
        const position = parseInt(borrower.position || 1);

        const matchedLenders = [];

        document.querySelectorAll('.lender').forEach(el => {
          const rawName = el.textContent.trim();
          const keyMatch = Object.entries(funderRules).find(([key]) =>
            key.toLowerCase().replace(/[^a-z]/g, '') === rawName.toLowerCase().replace(/[^a-z]/g, '')
          );
          if (!keyMatch) return;

          const [lenderName, rule] = keyMatch;
          const minFICO = rule.minFICO || 0;
          const minRev = rule.minRevenueMonthly || 0;
          const minTIB = rule.minTIB || 0;
          const industryRestricted = (rule.restrictedIndustries || []).some(r => industry.includes(r.toLowerCase()));
          const stateRestricted = (rule.restrictedStates || []).includes(state);
          const positionAllowed = !rule.positionsAccepted || rule.positionsAccepted.includes(position);

          let conditionalDecline = false;
          if (rule.conditionalDeclineRules) {
            for (let cond of rule.conditionalDeclineRules) {
              const condIndustry = (cond.industry || '').toLowerCase();
              if (industry.includes(condIndustry)) {
                if (cond.revenueLT && rev < cond.revenueLT) {
                  conditionalDecline = true;
                  break;
                }
                if (condIndustry === 'auto sales' && rev < 100000 && position === 1) {
                  conditionalDecline = true;
                  break;
                }
              }
            }
          }

          if (
            fico >= minFICO &&
            rev >= minRev &&
            tib >= minTIB &&
            !industryRestricted &&
            !stateRestricted &&
            !conditionalDecline &&
            positionAllowed
          ) {
            el.classList.add('selected');
            matchedLenders.push(rawName);
          }
        });

        document.getElementById('selected-lenders').innerHTML =
          matchedLenders.length ? matchedLenders.join('\n') : 'No eligible lenders matched.';
      })
      .catch(err => console.error('Auto-match fetch error:', err));
  </script>
</body>
</html>
